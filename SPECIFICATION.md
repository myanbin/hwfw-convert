# 文稿的全角字符和半角字符转换规范

版本：1.0 (2017.10)

## 一、背景

全角字符和半角字符（也叫全形字符和半形字符，以下简称全角和半角），是计算机中，中、日、韩文的 CJK 字符的显示格式。

传统上，英语或拉丁字母语言使用的电脑系统，每一个字母或符号，都是使用一字节的空间（一字节由 8 位元组成，共 256 个编码空间）来储存；而汉语、日语及韩语文字，由于数量大大超过 256 个，故惯常使用两字节来储存一个字符。在使用等宽字体（如 DOS、部分文字编辑器等）的环境下，中日韩文字此时占据两倍于西文字符的显示宽度。所以，中、日、韩等文字称为全形字符，相比起来，拉丁字母或数字就称为半形字符。有时为了使字体看起来齐整，英文字母、数字及其他符号也由原来只占一个字空间，改为占用两个字的空间显示、使用两个字节储存的格式。

比如半角字符 `a`，其编码为 `0x61`，对应的全角字符 `ａ`，其编码为 `0xff41`。下面是 Windows 系统中全角和半角字符的显示：

[Windows 命令提示符中显示的全角和半角字符](https://upload.wikimedia.org/wikipedia/commons/2/2b/Difference_Between_Halfwidth_and_Fullwidth.png)

## 二、适用字符集合

本节定义了转换规范需要处理的全角和半角字符的集合，共分为五类：

### 1、阿拉伯数字

半角形式（编码范围：`0x30〜0x39`）：

```
0 1 2 3 4 5 6 7 8 9
```

全角形式（编码范围：`0xff10〜0xff19`）：

```
０ １ ２ ３ ４ ５ ６ ７ ８ ９
```

### 2、拉丁字母

半角形式（编码范围：`0x41〜0x5a`，`0x61〜0x7a`）：

```
A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
a b c d e f g h i j k l m n o p q r s t u v w x y z
```

全角形式（编码范围：`0xff21〜0xff3a`，`0xff41〜0xff5a`）：

```
Ａ Ｂ Ｃ Ｄ Ｅ Ｆ Ｇ Ｈ Ｉ Ｊ Ｋ Ｌ Ｍ Ｎ Ｏ Ｐ Ｑ Ｒ Ｓ Ｔ Ｕ Ｖ Ｗ Ｘ Ｙ Ｚ
ａ ｂ ｃ ｄ ｅ ｆ ｇ ｈ ｉ ｊ ｋ ｌ ｍ ｎ ｏ ｐ ｑ ｒ ｓ ｔ ｕ ｖ ｗ ｘ ｙ ｚ
```

### 3、空格

半角空格（编码：`0x20`）和全角空格（编码：`0x3000`）。

### 4、拉丁符号

拉丁符号是指在拉丁字符集 ASCII 中除去控制字符、数字、拉丁字母和<u>可以被一一对应的标点符号</u>以外的大部分字符，常见的有：

```
" # $ % & ' * + - . / < = > @ [ \ ] ^ _ ` { | } ~
```

对应的全角形式是：

```
＂ ＃ ＄ ％ ＆ ＇ ＊ ＋ － ． ／ ＜ ＝ ＞ ＠ ［ ＼ ］ ＾ ＿ ｀ ｛ ｜ ｝
```

这些字符的全角形式可以在 Unicode 的 [Halfwidth and Fullwidth Forms](http://graphemica.com/blocks/halfwidth-and-fullwidth-forms) 区块（编码范围：`0xff01〜0xff96`）中找到并一一对应。

### 5、中日韩标点符号

根据《标点符号用法》（[GB/T 15834-2011](http://www.moe.gov.cn/ewebeditor/uploadfile/2015/01/13/20150113091548267.pdf)），中文标点符号是全角字符，分为点号和标号两类。其中：

1. 点号主要表示停顿和语气，分为句末点号（句号、问好、叹号）和句内点号（逗号、顿号、分号、冒号）
2. 标号主要标示某些词语的特定性质和作用，有引号、括号、破折号、省略号、着重号、连接号、间隔号、书名号、专名号、分隔号

以上所列的标点符号位于 Unicode 的 [CJK Symbols and Punctuation](http://graphemica.com/blocks/cjk-symbols-and-punctuation) 区块（编码范围：`0x3000〜0x303f`）内，主要有顿号、句号、各类括号及其他东南亚字符。

剩余的标点符号位于 Unicode 的 [General Punctuation](http://graphemica.com/blocks/general-punctuation) 区块（编码范围：`0x2000〜0x2069`）和 [Halfwidth and Fullwidth Forms](http://graphemica.com/blocks/halfwidth-and-fullwidth-forms) 区块（编码范围：`0xff01〜0xff96`）内。

## 三、转换规则

本节定义了全角和半角字符转换（以下简称转换）的详细规则及相应的示例。

### 1、输入和输出定义

转换的输入和输出应该是纯文本字符串，不包括含 HTML 标签的富文本字符串，亦不会对连续多个空格做特殊处理。关于对含 HTML 标签的富文本字符串的转换，请参阅附录二。

### 2、参数配置

为了对全角和半角字符进行灵活转换，应该设置弹性化的参数，对不同类型的字符集进行处理。下面是一种已被实现的参数设计：

1. 参数一：阿拉伯数字
2. 参数二：拉丁字母
3. 参数三：空格
4. 参数四：拉丁符号
5. 参数五：中日韩标点符号
6. 参数六：智能排除模式

对不同语种的文稿进行全角转半角或半角转全角时，应该设置符合该语种规范的转换参数，具体如下：

1. 中文稿件全角转半角，应默认设置开启参数一、二、六
2. 中文稿件半角转全角，应默认设置开启参数一、二、三、四、五、六
3. 英文稿件全角转半角，应默认设置开启参数一、二、三、四、五、六
4. 英文稿件半角转全角，默认不支持

### 3、转换阿拉伯数字

启动参数一，则会对阿拉伯数字（字符范围见 2.1 节）进行一一对应的转换。如果要处理数值型文本（如数值内千分位逗号），可参考 3.8.a 节的智能排除模式。

### 4、转换拉丁字母

启动参数二，则会对拉丁字母（字符范围见 2.2 节）进行一一对应的转换。

### 5、转换空格

启动参数三，则会对空格（字符范围见 2.3 节）进行一一对应的转换。

### 6、转换拉丁符号

启动参数四，则会对除数字、字母和可以被一一对应的标点符号以外的拉丁符号（字符范围见 2.4 节）进行一一对应的转换。但是需要注意一下几点：

1. 半角 `"` 和 `'` 所对应的全角形式为 `＂`（字符编码：`0xff02`）和 `＇`（字符编码：`0xff07`）。中文环境和英文环境中的引号有前引号（`“` 和 `‘`）和后引号（`”` 和 `’`）之分，其编码分别是 `0x201c`、`0x2018`、`0x201d`、`0x2019`。
2. 半角 `.` 所对应的全角形式为 `．`（字符编码：`0xff0e`）。只有在开启参数三的中日韩标点符号，才会与中文标点符号 `。`（字符编码：`0x3002`）互为转换。
3. 半角 `[` 和 `]` 所对应的全角形式为 `［`（字符编码：`0xff3b`）和 `］`（字符编码：`0xff3d`）。

### 7、转换中日韩标点符号

正常情况下，中日韩标点符号不需要进行转换，以免破坏文稿的标点符号用法。该参数一般在半角字符转全角字符时使用。

下面是一些在转换时应注意的特殊情况：

1. 半角的 `[` 和 `]` 应转换成全角形式的方头括号 `【`（字符编码：`0x3010`）和 `】`（字符编码：`0x3011`），反之亦然。
2. 半角的 `.`应转换成全角形式的中文句号 `。`（字符编码：`0x3002`），反之亦然。

### 8、智能排除模式

启动参数五，会打开智能排除模式。在该模式下会提供更加准确和丰富的转换效果。

#### a、会对数值型文本中的千分位逗号进行更准确的转换

如全角文本 `截止到２０１４年末，公司的总营业额为ＵＳ＄１３１，１００，０００，０００，同比增长１２.６％。` 在开启智能模式后，转换结果为 `截止到2014年末，公司的总营业额为US$131,100,000,000，同比增长12.6%。`。

#### b、会对 URL 文本中的冒号进行更准确的转换

如全角文本 `目前Ｇｏｏｇｌｅ的主域名ｈｔｔｐ：／／ｇｏｏｇｌｅ．ｃｏｍ为全世界访问量最高的站点。` 在开启智能模式后，转换结果为 `。目前Google的主域名http://google.com为全世界访问量最高的站点。`。


## 四、参考资料

1. https://zh.wikipedia.org/wiki/%E5%85%A8%E5%BD%A2%E5%92%8C%E5%8D%8A%E5%BD%A2
2. https://zh.wikipedia.org/wiki/%E6%A0%87%E7%82%B9%E7%AC%A6%E5%8F%B7
3. http://graphemica.com/blocks/cjk-symbols-and-punctuation
4. https://www.thepunctuationguide.com/index.html

## 附录

### 1、用于全半角转换的开源 JavaScript 模块 hwfw-convert

参加代码：https://github.com/myanbin/hwfw-convert

### 2、针对 HTML 标签的富文本输入的处理

参见代码：http://202.123.106.102:25223/rsfe/caibian-ng/snippets/2